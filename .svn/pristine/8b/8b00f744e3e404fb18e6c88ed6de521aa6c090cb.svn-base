<?php if(!defined("BASEPATH")) exit("Hack Attempt");
class Step_loan extends CI_Controller{
    function __construct(){
        parent::__construct();
        $this->load->model('general_model');
    }

    function index(){
        $this->data['title'] = 'Register';
    	$this->data['content'] = 'content/register/step1';
        $this->load->view('common/body', $this->data);
    }

    function do_step_1(){
        if(empty($this->session->userdata('register'))){
            redirect('Login');}

    	$period = $this->input->post('period');
    	$nilai = $this->input->post('nilai');

    	$step1 = [
    		'periode' => $period,
    		'nilai' => $nilai,
    		];

    	$this->session->set_userdata('step1', $step1);
        /*echo $this->session->userdata('step1')['nilai'];
        pre($this->session->userdata('step1')); exit();*/
        
        
    	redirect('step_loan/step_2');
    }

       function step_2(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/step2';
        $this->load->view('common/body', $this->data);
    }

    function do_step_2(){
        if(empty($this->session->userdata('step1'))){
            redirect('Step_loan');}

        $fullname = $this->input->post('fullname');
        $gender = $this->input->post('gender');
        $pob = $this->input->post('pob');
        $religion = $this->input->post('religion');
        $education = $this->input->post('education');
        $martial = $this->input->post('martial');
        $dependent = $this->input->post('dependent');
        $race = $this->input->post('race');

        $step2 = [
            // 'personal_fullname' => $fullname,
            'personal_gender' => $gender,
            'personal_birth_place' => $pob,
            'personal_religion' => $religion,
            'personal_education' => $education,
            'personal_martial_status' => $martial,
            'personal_dependents' => $dependent,
            'personal_race' => $race,
            ];

        $this->session->set_userdata('step2', $step2);
        redirect('step_loan/step_3');
    }

    function step_3(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/step3';
        $this->load->view('common/body', $this->data);
    }

    function do_step_3(){
     if(empty($this->session->userdata('step1')) && empty($this->session->userdata('step2'))){
            redirect('Step_loan');}

        $personal_id = $this->input->post('p_id');
        $m_number0 = $this->input->post('m_number0');
        $m_number1 = $this->input->post('m_number1');
        $address = $this->input->post('address');
        $home_status = $this->input->post('home_status');
        $how_long_year = $this->input->post('how_long_year');
        $how_long_month = $this->input->post('how_long_month');
        $province = $this->input->post('province');
        $city = $this->input->post('city');
        $sub_district = $this->input->post('sub_district');
        $post_code = $this->input->post('post_code');
        $phone_number = $this->input->post('phone_number');

        //Domicile address is similiar with above address
        
        $personal_id_ = $this->input->post('p_id_');
        $m_number0_ = $this->input->post('m_number0_');
        $m_number1_ = $this->input->post('m_number1_');
        $address_ = $this->input->post('address_');
        $home_status_ = $this->input->post('home_status_');
        $how_long_year_ = $this->input->post('how_long_year_');
        $how_long_month_ = $this->input->post('how_long_month_');
        $province_ = $this->input->post('province_');
        $city_ = $this->input->post('city_');
        $sub_district_ = $this->input->post('sub_district_');
        $post_code_ = $this->input->post('post_code_');
        $phone_number_ = $this->input->post('phone_number_');

        $domicile = $this->input->post('domicile');

        //closest family data 
        $f_name = $this->input->post('f_name');
        $f_address = $this->input->post('f_address');
        $f_province = $this->input->post('f_province');
        $f_city = $this->input->post('f_city');
        $f_district = $this->input->post('f_district');
        $f_village = $this->input->post('f_village');
        $f_post_code = $this->input->post('f_post_code');
        $f_phone_number = $this->input->post('f_phone_number');
        
        $step3 = [
            //personal data
            'personal_id' => $personal_id,
            'personal_mobile_number' => $m_number0,
            'personal_mobile_number2' => $m_number1,
            'personal_address' => $address,
            'personal_home_status' => $home_status,
            'personal_length_years' => $how_long_year,
            'personal_length_months' => $how_long_month,
            'personal_province' => $province,
            'personal_city' => $city,
            'personal_sub_district' => $sub_district,
            'personal_post_code' => $post_code,
            'personal_home_phone_number' => $phone_number,

            //domicile data
            'personal_domicile_id' => $personal_id_,
            'personal_domicile_mobile_number' => $m_number0_,
            'personal_domicile_mobile_number2' => $m_number1_,
            'personal_domicile_address' => $address_,
            'personal_domicile_home_status' => $home_status_,
            'personal_domicile_length_years' => $how_long_year_,
            'personal_domicile_length_months' => $how_long_month_,
            'personal_domicile_province' => $province_,
            'personal_domicile_city' => $city_,
            'personal_domicile_sub_district' => $sub_district_,
            'personal_domicile_post_code' => $post_code_,
            'personal_domicile_home_phone_number' => $phone_number_,

            //Family data
            'relative_full_name' => $f_name,
            'relative_address' => $f_address,
            'relative_province' => $f_province,
            'relative_city' => $f_city,
            'relative_sub_district' => $f_district,
            'relative_village' => $f_village,
            'relative_post_code' => $f_post_code,
            'relative_home_phone_number' => $f_phone_number,
            
            ];

        $this->session->set_userdata('step3', $step3);
        redirect('step_loan/step_4');
    }

    function step_4(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/step4';
        $this->load->view('common/body', $this->data);
    }

    function do_step_4(){
        if(empty($this->session->userdata('step1')) && empty($this->session->userdata('step2')) && empty($this->session->userdata('step3'))){
            redirect('Step_loan/step_3');}

        $bank_name = $this->input->post('bank_name');
        $account_name = $this->input->post('account_name');
        $account_number = $this->input->post('account_number');

        $step4 = [
            'bank_name' => $bank_name,
            'bank_account_name' => $account_name,
            'bank_account_number' => $account_number,
            ];

        $this->session->set_userdata('step4', $step4);
        redirect('step_loan/step_5');
    }

    function step_5(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/step5';
        $this->load->view('common/body', $this->data);
    }

    function do_step_5(){
        if(empty($this->session->userdata('step1')) && empty($this->session->userdata('step2')) && empty($this->session->userdata('step3')) && empty($this->session->userdata('step4'))){
            redirect('Step_loan/step_4');}

        //employment data
        $type = $this->input->post('type');
        $name = $this->input->post('name');
        $role = $this->input->post('role');
        $address = $this->input->post('address');
        $income = $this->input->post('income');
        $phone_number = $this->input->post('phone_number');
        $year = $this->input->post('year');
        $month = $this->input->post('month');
        $expenses = $this->input->post('expenses');
        $house_loan = $this->input->post('house_loan');
        $purpose = $this->input->post('purpose');
        $knowing = $this->input->post('knowing');

        $step5 = [
            'employment_type' => $type,
            'employment_company_name' => $name,
            'employment_company_role' => $role,
            'employment_company_address' => $address,
            'employment_company_phone_number' => $phone_number,
            'main_monthly_income' => $income,
            'employment_length_years' => $year,
            'employment_length_months' => $month,
            'house_of_loan' => $house_loan,
            'main_expenses' => $expenses,
            'purpose_of_loan' => $purpose,
            'knowing_butuh_uang' => $knowing,
            ];
        
        $this->session->set_userdata('step5', $step5);
        // pre($this->session->all_userdata()); exit();
        redirect('step_loan/step_6');
    }

    function step_6(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/step6';
        $this->load->view('common/body', $this->data);
    }

    function do_step_6(){
        if(empty($this->session->userdata('step1')) && empty($this->session->userdata('step2')) && empty($this->session->userdata('step3')) && empty($this->session->userdata('step4')) && empty($this->session->userdata('step5'))){
            redirect('Step_loan/step_5');}

        $agree0 = $this->input->post('agree0');
        $agree1 = $this->input->post('agree1');
        $agree2 = $this->input->post('agree2');
        $agree3 = $this->input->post('agree3');
        $agree4 = $this->input->post('agree4');
                

        if($agree0 == 0 or $agree1 == 0 or $agree2 == 0 or $agree3 == 0 or $agree4 == 0){
            $this->session->set_flashdata('agree0','Anda harus menyetujui seluruh persetujuan ini');
            redirect($_SERVER['HTTP_REFERER']);
        }
        $step6 = [
            'agree0' => $agree0,
            'agree1' => $agree1,
            'agree2' => $agree2,
            'agree3' => $agree3,
            'agree4' => $agree4,
            ];

        $this->session->set_userdata('step6', $step6);
        
        // $this->session->unset_userdata('register','step1','step2','step3','step4','step5','step6');

        $data = array_merge($this->session->userdata('step2'),$this->session->userdata('step3'),$this->session->userdata('step4'),$this->session->userdata('step5'),$this->session->userdata('register'));
        // $data = $this->session->all_userdata();
        // $datain = array($data['register'], $data['step2']);
        /*foreach($datain as $da){
            echo $da;
        }*/ 

        // pre($data); exit();
        $table = 'customer_list_tb';
        $this->general_model->insert_data($table, $data);
        $this->session->sess_destroy();

        redirect('step_loan/finished');
    }

    function finished(){
        $this->data['title'] = 'Register';
        $this->data['content'] = 'content/register/finish';
        $this->load->view('common/body', $this->data);
    }



}