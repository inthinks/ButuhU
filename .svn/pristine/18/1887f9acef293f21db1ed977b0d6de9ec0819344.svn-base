<script>
$(document).ready(function(){
    //var buttons = ['html','|','bold', 'italic','underline','|'];
    $('.redactor_editor').redactor({
        imageUpload: '<?php echo site_url('regaladmin/home/add_image');?>',
        linebreaks: true ,
        buttonSource: true,
        replaceDivs: false,
        buttonsHide: ['image'],
        //buttons: buttons

    });

    
});
</script>
<link rel="stylesheet" type="text/css" href="<?php echo base_url() ?>templates/css/modal.css">
<script src="<?php echo base_url() ?>templates/js/bootstrap.min.js"></script>
</style>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="memberModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h1 class="modal-title" id="memberModalLabel">Home process &raquo; Edit Home process</h1>
                </div>
                <!-- tempat menampilkan modal dari showdata.php --> 
                <div class="ct" >
              
                </div>

            </div>
        </div>
    </div>

<div class="contentArea">
    <div class="contentBox">
    	<h1>Process &raquo; List</h1>
        <a class="defBtn" id="add_pro" onclick="$('#xxx').show(); $('#add_pro').hide(); $('#hide_pro').show();"><span>Add New Process</span></a>
        <a class="defBtn" style="display:none" id="hide_pro" onclick="$('#xxx').hide(); $('#add_pro').show(); $('#hide_pro').hide();"><span>Hide</span></a>

        <div class="contentForm">
        <form method="post" id="xxx" enctype="multipart/form-data" style="display:none" action="<?php echo site_url('regaladmin/process/do_add')?>">
            <input type="hidden" id="active" name="active" value="1">
            <fieldset>
                <div class="page-wrap">
                <div class="styled-input wide">
                    <input type="text" name="title_id" />
                    <label>Title ID</label>
                    <span></span>
                </div>     
                <div>
                    <label>Description ID</label>
                    <div class="styled-input wide">
                        <textarea class="redactor_editor" name="description_id" id="description"></textarea>
                        <span></span>
                    </div>
                </div>
                <div class="styled-input wide">
                    <input type="text" name="title_en"  />
                    <label>Title EN</label>
                    <span></span>
                </div>         
                <label>Description EN</label>
                    <div class="styled-input wide">
                        <textarea class="redactor_editor" name="description_en" id="description"></textarea>
                        <span></span>
                    </div>
                      
                    <div class="styled-input wide">
                        <input type="file" class="txtField" name="image" id="image" required/>
                        <!--label>Best resolution for desktop image is 1440 x 340 px</label-->
                        <span></span>
                    </div>         
                </div>
                <input type="submit" class="defBtn" value="Submit" />  <input type="button" class="defBtn" value="Back" onclick="window.location='<?php echo site_url('regaladmin/process')?>';" />
            </fieldset>
        </form>
        <?php if($this->session->flashdata('notif2')) echo "<font color='red'>".$this->session->flashdata('notif2')."</font>";?>
        </div>
	
        <div class="contentTable">
            <table class="tablesorter"  id="table-1" width="100%">
                <thead>
                    <tr>
                        <th width="5%">No</th>
                        <th width="10%">Action</th>
                        <th width="15%">Image</th>
                        <th width="15%">Description ID</th>
                        <th width="15%">Description EN</th>
                        <th width="15%">Created Date</th>
                        <th width="15%">Updated Date</th>
                        <th width="15%">Status</th>
                        <!-- <th width="15%">Precedence</th> -->
                    </tr>
                </thead>
                <tbody id="drag">
                    <?php $no=1;
                    $count=count($process);foreach($process as $list){
                        ?>
                        
                        <tr id="<?php echo $list['id'] ?>" >
                            <td><?php echo $no;?>
                            <input type="hidden" name="id" value="<?php echo $list['id'];?>" id="id<?php echo $list['id'];?>" />
                            <input type="hidden" name="precedence" value="<?php echo $list['precedence'];?>" id="precedence<?php echo $list['id'];?>" />
                            </td>
                            <td>
                            <a class="fa fa-edit" style="font-size: 18px;" title="Edit" href="#" data-toggle="modal" data-target="#myModal" data-whatever="<?php echo $list['id']; ?>"></a> |
                            <a class="fa fa-trash" style="font-size: 18px;" title="Delete" href="<?php echo site_url('regaladmin/process/do_delete').'/'.$list['id'];?>" onclick="return confirm('Delete?');"></a>
                            </td>
                            <td><img src="<?php echo base_url()."userdata/process/".$list['image'];?>" width="200px" height="80px"></td>
                            <td>
                                <b>
                                <?php
                                    echo ($list['title_ind']);?> </b><br>
                                <?php
                                    $limited_character = word_limiter($list['description_ind'],10);
                                    echo $limited_character;
                                ?>
                            </td>
                            <td><b>
                                <?php
                                echo ($list['title_en']);?> </b><br>
                                <?php
                                $limited_character = word_limiter($list['description_eng'],10);
                                echo $limited_character;
                                ?>
                            </td>

                            <td><?php echo ($list['created_date']);?></td>
                            <td><?php echo ($list['updated_date']);?></td>
                            <td>
                             <?php 
        						if($list['status']==1){
        							$class='class="fa fa-check-circle" style="color:green;"';
        							$title='Active';
        						}
        						else{
        							$class='class="fa fa-times-circle" style="color:red;"';
        							$title='Inactive';
        						}
        						?>
        						<a <?php echo $class?> href="<?php echo site_url('regaladmin/process/active').'/'.$list['id'].'/'.$list['status']; ?>" title="<?php echo $title?>"></a>
                                  
                          </td>
                         <!--  <td class="abc">
                         
                                                 <?php if ($list['precedence'] != first_precedence('process_tb')){?>
                           <a title="Down" class="fa fa-chevron-down" href="<?php echo site_url('regaladmin/process/down/'.$list['id']);?>"></a> 
                                                 <?php }
                           if($list['precedence']!=first_precedence('process_tb') and  $list['precedence'] != last_precedence('process_tb')) echo "  ";
                           if ($list['precedence'] != last_precedence('process_tb')){?>
                           <a title="Up" class="fa fa-chevron-up" href="<?php echo site_url('regaladmin/process/up/'.$list['id']);?>"></a>
                                                 <?php }?>
                         </td> -->
                        </tr>
                        
                    <?php $no++;}?>
                </tbody>

                <tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
         </div>
      
    </div>
</div>

      </div>
</div>

 <script>
   
    $('#myModal').on('show.bs.modal', function (event) {
          var button = $(event.relatedTarget) // Button that triggered the modal
          var recipient = button.data('whatever') // Extract info from data-* attributes
          var modal = $(this);
          var dataString = 'id=' + recipient;

            $.ajax({
                type: "GET",
                url: base_url+'regaladmin/process/edit',
                data: dataString,
                cache: false,
                success: function (data) {
                    console.log(data);
                    modal.find('.ct').html(data);
                },
                error: function(err) {
                    console.log(err);
                }
            });  
    })
// </script>

// <script type="text/javascript">
// $(document).ready(function(){
//  $(function() {
//  $("#drag").sortable({ opacity: 0.6, cursor: 'move', update: function() {
//  var order = $(this).sortable("serialize") + '&action=updateRecordsListings';
//  $.post("process/drag_prec/" + $('#drag tr').attr('id'), order);
//  alert($('#drag tr').attr('id'));

//  }
//  });
//  });
 
// });
// </script>


// <script>

//         $.ajaxSetup({
//             headers: { 'X-CSRF-Token' : $('meta[name=_token]').attr('content') }
//         });

//         $("#myTable").tableDnD({
//             onDragClass: 'tableCellOnDrag',
//             onDrop: function(table, row){
//                 $.ajax({
//                     type: "post",
//                     url: base_url+'regaladmin/process/update_group_precedence',
//                     data: $.tableDnD.serialize(),
//                     success: function(temp){
//                         var i = 1;
//                         $( ".abc" ).each( function( index, element ){

//                             $(this).text(i);
//                             i++;
//                         });
//                     }
//                 });
//             }
//         });

//     </script>


<script type="text/javascript">
var product_list_url='<?php echo site_url('regaladmin/process/index');?>';

$(document).ready(function() {
    <?php   
    //if($sub_category_id=="all" or $sub_category_id==""){?>
    
    // Initialise the table
    $("#table-1").tableDnD({
        onDragClass: 'tableCellOnDrag',
        onDrop: function(table, row){
            var rows = table.tBodies[0].rows;
            var prev_id=parseFloat($('tr#'+row.id).prev().attr('id'));
            var next_id=parseFloat($('tr#'+row.id).next().attr('id'));
            var curr_id=parseFloat($('#id'+row.id).val());
            
            if(isNaN(prev_id)){
                //alert('most top');
                prev_id='t';
            }
            if(isNaN(next_id)){
                //alert('most bottom');
                next_id='b';
            }
            
            $.ajax({
                type: "POST",
                url: '<?php echo site_url('regaladmin/process/reposition_precedence');?>',
                data: 'curr_id='+curr_id+'&prev_id='+prev_id+'&next_id='+next_id,   
                success: function(){
                    
                }
            });
        }
    });
   
    // Initialise the table
    // $("#table-1").tableDnD({
    //     onDragClass: 'tableCellOnDrag',
    //     onDrop: function(table, row){
    //         var rows = table.tBodies[0].rows;
    //         var prev_id=parseFloat($('tr#'+row.id).prev().attr('id'));
    //         var next_id=parseFloat($('tr#'+row.id).next().attr('id'));
    //         var curr_id=parseFloat($('#product_id'+row.id).val());
            
    //         if(isNaN(prev_id)){
    //             //alert('most top');
    //             prev_id=curr_id-1;
    //         }
    //         if(isNaN(next_id)){
    //             //alert('most bottom');
    //             next_id=curr_id+1;
    //         }
            
    //         $.ajax({
    //             type: "POST",
    //             url: '<?php echo site_url('fncoadmin/product/update_precedence3');?>',
    //             data: 'curr_id='+curr_id+'&prev_id='+prev_id+'&next_id='+next_id,               
    //             success: function(){
                
    //             }
    //         });
    //     }
    // });
    
});
</script>
